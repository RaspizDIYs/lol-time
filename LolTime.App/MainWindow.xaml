<ui:FluentWindow x:Class="LolTime.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:vm="clr-namespace:LolTime.App.ViewModels"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        mc:Ignorable="d"
        Title="LolTime"
        Width="700"
        Height="500"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        WindowStartupLocation="CenterScreen">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <tb:TaskbarIcon x:Name="TrayIcon"
                        IconSource="pack://application:,,,/Assets/icon.ico"
                        ToolTipText="LolTime"
                        DoubleClickCommand="{Binding ShowWindowCommand}">
             <tb:TaskbarIcon.ContextMenu>
                 <ContextMenu>
                     <MenuItem Header="Show Stats" Command="{Binding ShowWindowCommand}" />
                     <MenuItem Header="Exit" Command="{Binding ExitCommand}" />
                 </ContextMenu>
             </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>

        <ui:TitleBar Grid.Row="0" Title="LolTime Stats" Icon="{x:Null}" />

        <TabControl Grid.Row="1" Margin="10">
            <TabItem Header="Сегодня">
                <Grid Margin="0,10,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" MinWidth="200"/>
                            <ColumnDefinition Width="*" MinWidth="200"/>
                            <ColumnDefinition Width="*" MinWidth="200"/>
                        </Grid.ColumnDefinitions>

                        <ui:Card Grid.Column="0" Margin="4">
                            <StackPanel>
                                <TextBlock Text="Сегодня" FontSize="14" Opacity="0.7"/>
                                <TextBlock Text="{Binding Tracker.TodayTime, StringFormat='{}{0:hh\\:mm\\:ss}'}"
                                           FontSize="40" FontWeight="Bold"/>
                                <ProgressBar Margin="0,8,0,0"
                                             Minimum="0"
                                             Maximum="{Binding Settings.DailyLimit.TotalMinutes, Mode=OneWay}"
                                             Value="{Binding Tracker.TodayTime.TotalMinutes, Mode=OneWay}"/>
                                <TextBlock Text="{Binding Settings.DailyLimit, StringFormat='Лимит: {0:hh\\:mm}'}"
                                           FontSize="12"
                                           Opacity="0.7"/>
                            </StackPanel>
                        </ui:Card>

                        <ui:Card Grid.Column="1" Margin="4">
                            <StackPanel>
                                <TextBlock Text="Текущая сессия" FontSize="14" Opacity="0.7"/>
                                <TextBlock Text="{Binding Tracker.CurrentSessionDuration, StringFormat='{}{0:hh\\:mm\\:ss}'}"
                                           FontSize="40" FontWeight="Bold"/>
                                <TextBlock Text="{Binding Tracker.WeekTime, StringFormat='Неделя: {0:hh\\:mm}'}"
                                           FontSize="12"
                                           Opacity="0.7"/>
                                <TextBlock Text="{Binding Tracker.WeekendTime, StringFormat='Выходные: {0:hh\\:mm}'}"
                                           FontSize="12"
                                           Opacity="0.7"/>
                            </StackPanel>
                        </ui:Card>

                        <ui:Card Grid.Column="2" Margin="4">
                            <StackPanel>
                                <TextBlock Text="Всего" FontSize="14" Opacity="0.7"/>
                                <TextBlock Text="{Binding Tracker.TotalTime, StringFormat='{}{0:hh\\:mm}'}"
                                           FontSize="40" FontWeight="Bold"/>
                                <TextBlock Text="{Binding Tracker.MonthTime, StringFormat='Месяц: {0:hh\\:mm}'}"
                                           FontSize="12"
                                           Opacity="0.7"/>
                                <TextBlock Text="{Binding Tracker.WeekTime, StringFormat='Неделя: {0:hh\\:mm}'}"
                                           FontSize="12"
                                           Opacity="0.7"/>
                            </StackPanel>
                        </ui:Card>
                    </Grid>

                    <Grid Grid.Row="1" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" MinWidth="300"/>
                            <ColumnDefinition Width="*" MinWidth="200"/>
                        </Grid.ColumnDefinitions>

                        <ui:Card Grid.Column="0" Margin="4">
                            <StackPanel>
                                <TextBlock Text="Напоминание"
                                           FontSize="14"
                                           Opacity="0.7"/>
                                <TextBlock Text="{Binding Settings.AlertMessage}"
                                           FontSize="16"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </ui:Card>

                        <ui:Card Grid.Column="1" Margin="4">
                            <StackPanel>
                                <TextBlock Text="Границы"
                                           FontSize="14"
                                           Opacity="0.7"/>
                                <TextBlock Text="{Binding Settings.SessionLimit, StringFormat='Сессия: {0:hh\\:mm}'}"
                                           Margin="0,6,0,0"/>
                                <TextBlock Text="{Binding Settings.DailyLimit, StringFormat='День: {0:hh\\:mm}'}"/>
                                <TextBlock Text="{Binding Settings.WeeklyLimit, StringFormat='Неделя: {0:hh\\:mm}'}"/>
                            </StackPanel>
                        </ui:Card>
                    </Grid>

                    <ui:Card Grid.Row="2">
                        <StackPanel>
                            <TextBlock Text="Последние сессии" FontSize="16" FontWeight="Bold"/>
                            <ItemsControl ItemsSource="{Binding History}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,8,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding Date, StringFormat={}{0:dd MMM}}" FontWeight="SemiBold"/>
                                            <TextBlock Grid.Column="1"
                                                       Text="{Binding TotalTime, StringFormat='{}{0:hh\\:mm}'}"
                                                       HorizontalAlignment="Right"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </ui:Card>
                </Grid>
            </TabItem>

            <TabItem Header="Обзор">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" MinWidth="200"/>
                        <ColumnDefinition Width="*" MinWidth="200"/>
                    </Grid.ColumnDefinitions>

                    <ui:Card Grid.Row="0" Grid.Column="0" Margin="4">
                        <StackPanel>
                            <TextBlock Text="Неделя" FontSize="14" Opacity="0.7"/>
                            <TextBlock Text="{Binding Tracker.WeekTime, StringFormat='{}{0:hh\\:mm}'}"
                                       FontSize="36" FontWeight="Bold"/>
                        </StackPanel>
                    </ui:Card>

                    <ui:Card Grid.Row="0" Grid.Column="1" Margin="4">
                        <StackPanel>
                            <TextBlock Text="Выходные" FontSize="14" Opacity="0.7"/>
                            <TextBlock Text="{Binding Tracker.WeekendTime, StringFormat='{}{0:hh\\:mm}'}"
                                       FontSize="36" FontWeight="Bold"/>
                        </StackPanel>
                    </ui:Card>

                    <ui:Card Grid.Row="1" Grid.Column="0" Margin="4">
                        <StackPanel>
                            <TextBlock Text="Месяц" FontSize="14" Opacity="0.7"/>
                            <TextBlock Text="{Binding Tracker.MonthTime, StringFormat='{}{0:hh\\:mm}'}"
                                       FontSize="36" FontWeight="Bold"/>
                        </StackPanel>
                    </ui:Card>

                    <ui:Card Grid.Row="1" Grid.Column="1" Margin="4">
                        <StackPanel>
                            <TextBlock Text="Всего" FontSize="14" Opacity="0.7"/>
                            <TextBlock Text="{Binding Tracker.TotalTime, StringFormat='{}{0:hh\\:mm}'}"
                                       FontSize="36" FontWeight="Bold"/>
                        </StackPanel>
                    </ui:Card>
                </Grid>
            </TabItem>

            <TabItem Header="История">
                <ui:Card Margin="10">
                    <DockPanel>
                        <TextBlock Text="Дневники"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   DockPanel.Dock="Top"
                                   Margin="0,0,0,8"/>
                        <DataGrid ItemsSource="{Binding History}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  SelectionUnit="FullRow"
                                  CanUserAddRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=d}" Width="*"/>
                                <DataGridTextColumn Header="Время" Binding="{Binding TotalTime, StringFormat='{}{0:hh\\:mm}'}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </ui:Card>
            </TabItem>

            <TabItem Header="Настройки">
                <ScrollViewer>
                    <StackPanel Margin="20" >
                        <TextBlock Text="Основные лимиты" FontSize="18" FontWeight="Bold"/>
                        <Grid Margin="0,12,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" MinWidth="300"/>
                                <ColumnDefinition Width="*" MinWidth="300"/>
                            </Grid.ColumnDefinitions>
                            <ui:Card Grid.Column="0" Margin="4">
                                <StackPanel>
                                    <TextBlock Text="Дневной лимит (часы)" FontSize="14" Opacity="0.7"/>
                                    <ui:TextBox Text="{Binding DailyLimitHours}" Margin="0,6,0,0"/>
                                    <TextBlock Text="Недельный лимит (часы)" FontSize="14" Opacity="0.7" Margin="0,12,0,0"/>
                                    <ui:TextBox Text="{Binding WeeklyLimitHours}" Margin="0,6,0,0"/>
                                    <ui:Button Content="Сохранить" Command="{Binding SaveSettingsCommand}" Margin="0,16,0,0" Width="120"/>
                                </StackPanel>
                            </ui:Card>
                            <ui:Card Grid.Column="1" Margin="4">
                                <StackPanel>
                                    <TextBlock Text="Поведение" FontSize="14" Opacity="0.7"/>
                                    <ui:ToggleSwitch Content="Автостарт вместе с LoL" IsChecked="{Binding Settings.AutoStart}" Margin="0,8,0,0"/>
                                    <ui:ToggleSwitch Content="Жёсткий режим (спам уведомлениями)" IsChecked="{Binding Settings.HardMode}" Margin="0,8,0,0"/>
                                    <TextBlock Text="Сообщение" FontSize="14" Opacity="0.7" Margin="0,16,0,0"/>
                                    <ui:TextBox Text="{Binding Settings.AlertMessage}" Margin="0,6,0,0" AcceptsReturn="True" Height="80" TextWrapping="Wrap"/>
                                </StackPanel>
                            </ui:Card>
                        </Grid>
                        
                        <TextBlock Text="Медиа" FontSize="18" FontWeight="Bold" Margin="0,24,0,0"/>
                        <ui:Card Margin="0,12,0,0">
                            <StackPanel>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ui:TextBox Text="{Binding Settings.AlertImagePath}" PlaceholderText="Путь к картинке" IsReadOnly="True"/>
                                    <ui:Button Grid.Column="1" Content="..." Command="{Binding BrowseImageCommand}" Margin="10,0,0,0" Width="40"/>
                                </Grid>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ui:TextBox Text="{Binding Settings.AlertSoundPath}" PlaceholderText="Путь к звуку" IsReadOnly="True"/>
                                    <ui:Button Grid.Column="1" Content="..." Command="{Binding BrowseSoundCommand}" Margin="10,0,0,0" Width="40"/>
                                </Grid>
                            </StackPanel>
                        </ui:Card>

                        <TextBlock Text="О приложении" FontSize="18" FontWeight="Bold" Margin="0,24,0,0"/>
                        <ui:Card Margin="0,12,0,20">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="{Binding AppVersion}" 
                                           VerticalAlignment="Center" 
                                           FontSize="14" 
                                           Opacity="0.7"
                                           Margin="0,0,20,0"/>
                                           
                                <ui:Button Content="Проверить обновления" 
                                           Icon="{ui:SymbolIcon SymbolRegular.ArrowSync24}"
                                           Command="{Binding CheckUpdatesCommand}" 
                                           Width="200"/>
                            </StackPanel>
                        </ui:Card>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <ui:SnackbarPresenter x:Name="SnackbarPresenter" Grid.RowSpan="2" />
    </Grid>
</ui:FluentWindow>
